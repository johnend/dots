#  ████████╗███╗   ███╗██╗   ██╗██╗  ██╗
#  ╚══██╔══╝████╗ ████║██║   ██║╚██╗██╔╝
#     ██║   ██╔████╔██║██║   ██║ ╚███╔╝ 
#     ██║   ██║╚██╔╝██║██║   ██║ ██╔██╗ 
#     ██║   ██║ ╚═╝ ██║╚██████╔╝██╔╝ ██╗
#     ╚═╝   ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═╝

###############################################################################
# Options
###############################################################################

set -g  default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g  history-limit 50000
set -g  detach-on-destroy off
set -g  renumber-windows on

set -g  bell-action none

# mouse enbabled
set -g  mouse on

# Vim style keybinds
set -g  mode-keys vi
set -gs  escape-time 10

# status
set -g  display-time 3000
set -g  status-interval 5
set -g  status-position top
set -g  base-index 1
set -gp pane-border-status top


# layouts
set -g  main-pane-width 66% 
set -g  main-pane-height 66% 

###############################################################################
# Keybinds
###############################################################################

# unbind all defaults
unbind -a -T prefix
unbind -a -T root
unbind -a -T copy-mode-vi

# leader
set -g prefix C-s


# navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# pane management
bind    v   split-window -h -c '#{pane_current_path}'
bind    s   split-window -v -c '#{pane_current_path}'
bind    M-s select-layout main-horizontal
bind -n M-v select-layout main-vertical
bind    C-t select-layout tiled
bind    z   resize-pane -Z
bind -r H   resize-pane -L
bind -r J   resize-pane -D
bind -r K   resize-pane -U
bind -r L   resize-pane -R

# windows
bind    t     new-window      -a -t '{end}'
bind    n     command-prompt  -p    "Session name:" "new-session -s '%1'"
bind    Tab   select-window   -t:+
bind    BTab  select-window   -t:-
bind    x     kill-window
bind    1     select-window -t 1
bind    2     select-window -t 2
bind    3     select-window -t 3
bind    4     select-window -t 4
bind    5     select-window -t 5
bind    6     select-window -t 6
bind    7     select-window -t 7
bind    8     select-window -t 8
bind    9     select-window -t 9

# meta commands
bind r source-file ~/.config/tmux/tmux.conf; display-message "tmux.conf reloaded"
bind q detach
bind ? list-keys
bind Enter command-prompt
bind Space copy-mode 

# if selection exists, clear selection, otherwise begin selection
bind -T copy-mode-vi Space    if -F "#{selection_present}" {send -X clear-selection} {send -X begin-selection}

bind -T copy-mode-vi Escape   send -X cancel
bind -T copy-mode-vi Up       send -X cursor-up
bind -T copy-mode-vi Down     send -X cursor-down
bind -T copy-mode-vi Left     send -X cursor-left
bind -T copy-mode-vi Right    send -X cursor-right

bind -T copy-mode-vi v        send -X begin-selection
bind -T copy-mode-vi y        send -X copy-selection # same as yank (note adding -no-clear doesn't remove the selection) 
bind -T copy-mode-vi Enter    send -X copy-selection-and-cancel # copies the selection and exits copy mode

# copies the selection to system clipboard on mac or linux
if "unaame | grep -q Darwin" { bind -T copy-mode-vi y send -X copy-pipe 'pbcopy' }
if "unaame | grep -q Linux" { bind -T copy-mode-vi y send -X copy-pipe 'xclip -i -selection clipboard' }

# Restore unbound mouse commands
bind -T root MouseDown1Pane { select-pane -t =; send -M }
bind -n MouseDown1Status select-window -t =
bind -n MouseDown3Pane   if -F -t= "#{mouse_any_flag}" { select-pane -t=; send -M } { select-pane -mt= }
bind -n MouseDrag1Pane   if -F -t= "#{mouse_any_flag}" { if -Ft= "#{pane_in_mode}" { copy-mode -M } { send -M } } { copy-mode -M }
bind -n MouseDrag1Border resize-pane -M
bind -n WheelUpPane      if -F -t= "#{mouse_any_flag}" { send -M } { if -Ft= "#{pane_in_mode}" { send -M } { copy-mode -et= } }
bind -n WheelUpStatus    previous-window
bind -n WheelDownStatus  next-window

# Restores unbound copy-mode mouse commands
bind -T copy-mode-vi MouseDown1Pane    select-pane
bind -T copy-mode-vi MouseDrag1Pane    { select-pane; send -X begin-selection }
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-no-clear
bind -T copy-mode-vi WheelUpPane       { select-pane; send -X -N 5 scroll-up }
bind -T copy-mode-vi WheelDownPane     { select-pane; send -X -N 5 scroll-down }
bind -T copy-mode-vi DoubleClick1Pane  { select-pane; send -X select-word }
bind -T copy-mode-vi TripleClick1Pane  { select-pane; send -X select-line }

# session picker

bind    T   run-shell "sesh connect \"$(
            sesh list | fzf-tmux -p 55%,60% \
                --no-sort --ansi --border-label ' sesh ' --prompt '󱐋  ' \
                --header ' ^e everything ^m tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
                --bind 'Down:down,Up:up' \
                --bind 'ctrl-e:change-prompt(  )+reload(sesh list)' \
                --bind 'ctrl-m:change-prompt(  )+reload(sesh list -t)' \
                --bind 'ctrl-g:change-prompt(  )+reload(sesh list -c)' \
                --bind 'ctrl-x:change-prompt(󰥨  )+reload(sesh list -z)' \
                --bind 'ctrl-f:change-prompt(  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
                --bind 'ctrl-d:change-prompt(󰧻  )+reload(tmux kill-session -t {})+change-prompt(󰧻   )+reload(sesh list)'
)\""

###############################################################################
# Plugins
###############################################################################

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux'
# set -g @plugin 'christoomey/vim-tmux-navigator' # requires the equivalent plugin in NeoVim

# Catppuccin theme settings

# window
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"

set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"

set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"

# pane settings
set -g @catppuccin_pane_border_style "fg=#{thm_gray}"
set -g @catppuccin_pane_active_border_style "fg=#{thm_magenta}"

# status bar
set -g @catppuccin_status_modules_right "directory session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"

set -g @catppuccin_status_background "default"

set -g @catppuccin_directory_text "#{pane_current_path}"

# run the plugins configs etc.
run '~/.config/tmux/plugins/tpm/tpm'
